{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ ad.brand }} {{ ad.model }} - Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
</head>
<body class="bg-light">
  <div class="container my-5">

    <div class="card shadow-sm">
      {% if ad.image %}
        <img src="{{ ad.image.url }}" alt="Car Image" class="card-img-top" />
      {% endif %}
      <div class="card-body">
        <h2 class="card-title">{{ ad.brand }} {{ ad.model }}</h2>
        <p class="card-text"><strong>Price:</strong> {{ ad.price }} –ª–≤.</p>
        <p class="card-text"><strong>Description:</strong> {{ ad.description }}</p>
        <p class="card-text"><strong>Year:</strong> {{ ad.year }}</p>
        <p class="card-text"><strong>Owner:</strong> {{ ad.owner.username }}</p>

        <div class="d-flex gap-2 my-3 flex-wrap">
          {% if user == ad.owner or user.is_superuser %}
            <a href="{% url 'edit_ad' ad.pk %}" class="btn btn-outline-primary flex-grow-1 flex-sm-grow-0">Edit</a>
            <a href="{% url 'delete_ad' ad.pk %}" class="btn btn-outline-danger flex-grow-1 flex-sm-grow-0">Delete</a>
          {% endif %}
          <form action="{% url 'toggle_favorite' ad.pk %}" method="post" class="flex-grow-1 flex-sm-grow-0">
            {% csrf_token %}
            {% if is_favorite %}
              <button type="submit" class="btn btn-warning w-100">Remove from Favorites</button>
            {% else %}
              <button type="submit" class="btn btn-primary w-100">Add to Favorites</button>
            {% endif %}
          </form>
        </div>
      </div>
    </div>

    <hr class="my-5">

    <h3>Comments</h3>

    {% if comments %}
      <ul class="list-group">
        {% for comment in comments %}
          <li class="list-group-item">
            <h6>{{ comment.author.username }}</h6>
            <small>{{ comment.created_at|date:"SHORT_DATETIME_FORMAT" }}</small>
            <p class="mt-2">{{ comment.content|linebreaks }}</p>

            {% if user.is_authenticated %}
              {% if user.is_staff %}
                <form action="{% url 'comment_delete' comment.pk %}" method="post" class="d-inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-danger" title="Delete comment">üóëÔ∏è Delete</button>
                </form>
              {% else %}
                {% for group in user.groups.all %}
                  {% if group.name == 'staff' %}
                    <form action="{% url 'comment_delete' comment.pk %}" method="post" class="d-inline">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-danger" title="Delete comment">üóëÔ∏è Delete</button>
                    </form>
                  {% endif %}
                {% endfor %}
              {% endif %}
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">No comments yet.</p>
    {% endif %}

    {% if user.is_authenticated %}
      <div class="card p-4 mt-4">
        <h4>Add your comment</h4>
        <form method="post">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" class="btn btn-primary w-100 mt-3">Submit</button>
        </form>
      </div>
    {% else %}
      <p><a href="{% url 'login' %}">Log in</a> to post a comment.</p>
    {% endif %}

    <div class="mt-4 text-center">
      <a href="{% url 'home' %}" class="btn btn-secondary">Go back</a>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
